#center
  %h1
    = @customer.pretty_name 
    = link_to '[All Customers]', customers_path
  
#right_small
  %h2 Account
  %table{:width => "80%"}
    %tr
      %td Total Orders
      %td{:class => "number"}= format_currency(@customer.total_orders)
    %tr
      %td Total Payments
      %td{:class => "number"}= format_currency(@customer.total_payments)
    %tr
      %td Account Balance
      %td{:class => "number"}= format_currency(@customer.account_balance)
  
#left_large
  %h2 
    = 'Details' 
    = link_to icon_edit, edit_customer_path(@customer)

  %table{:width => "80%"}
    %tr
      %td Address
      %td= @customer.pretty_address
    %tr
      %td Email
      %td= mail_to(@customer.email, @customer.email, :subject => "StockMgr", :body => "Hi " + @customer.first_name)
    %tr
      %td Phone
      %td= @customer.pretty_phone

#center
  %h2
    = 'Orders'
    = link_to('Add', {:controller => 'sales_orders', :action => 'new', :id => @customer.id})
  #box
    %table{:class => "listing", :width => "100%"}
      %tr
        %th Order
        %th Created
        %th 
          = 'Public' 
          = 'Comment'                        
        %th 
          = 'Private' 
          = 'Comment'                        
        %th Invoiced?
        %th Paid?
        %th Sale Price
        %th
      - @customer.sales_orders.order('created_at DESC').each do |order|
        %tr{:class => (cycle 'odd', 'even')}
          %td{:class => 'status'}= link_to order.id, order
          %td{:class => 'status', :width => "12%"}= format_date(order.created_at)
          %td{:class => 'text'}= order.public_comment
          %td{:class => 'text'}= order.private_comment
          %td{:class => 'status', :width => "8%"}= link_to format_boolean(order.invoiced?), toggle_order_invoiced_status_customer_url(:id => @customer.id, :order_id => order.id), :method => :put
          %td{:class => 'status', :width => "8%"}= link_to format_boolean(order.paid?), toggle_order_paid_status_customer_url(:id => @customer.id, :order_id => order.id), :method => :put
          %td{:class => 'status', :width => "8%"}=  format_currency(order.total_price)
          %td{:class => 'status', :width => "10%"}
            - if order.invoiced?
              = link_to(icon_pdf, :controller => 'sales_orders', :action => 'invoice_pdf', :id => order.id)
            - else
              = link_to(icon_pdf, :controller => 'sales_orders', :action => 'invoice_pdf', :id => order.id)
              = link_to icon_edit, edit_sales_order_path(order)
              = link_to icon_delete, sales_order_path(order), :confirm => 'Delete - Are you sure?', :method => :delete

  %h2
    = 'Payments'
    = link_to('Add', {:controller => 'payments', :action => 'new', :id => @customer.id})
  #box
    %table{:class => "listing", :width => "100%"}
      %tr
        %th Payment
        %th Received
        %th Comment
        %th Type
        %th Amount
        %th
      - @customer.payments.order('created_at DESC').each do |payment|
        %tr{:class => (cycle 'odd', 'even')}
          %td{:class => 'status', :width => "7%"}= link_to payment.id, payment
          %td{:class => 'status', :width => "12%"}= format_date(payment.received_at)
          %td{:class => 'text'}= payment.comment
          %td{:class => 'status', :width => "16%"}= payment.payment_type.name
          %td{:class => 'status', :width => "8%"}= format_currency(payment.amount)
          %td{:class => 'status', :width => "10%"}
            = link_to icon_edit, edit_payment_path(payment)
            = link_to icon_delete, payment, :confirm => 'Delete - Are you sure?', :method => :delete

